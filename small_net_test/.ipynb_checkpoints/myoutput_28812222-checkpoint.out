=== CNN Training ===
Configuration: {'img_size': 256, 'dropout': 0.1, 'batch_size': 32, 'lr': 0.0002, 'weight_decay': 0.0001, 'epochs': 90, 'patience': 20, 'k_samples': 15000, 'model_type': 'large', 'map_type': 'tot', 'data_type': 'sid', 'blur_kernel': 0, 'conv_kernel_size': 9, 'normalize': False}
Warning: WDM_TNG_MW_SB4.txt not found, using random indices

Dataset split:
Total: 15000, Train: 9000, Val: 3000, Test: 3000

Loading datasets...
Loading CDM data from /n/netscratch/iaifi_lab/Lab/msliu/CMD/data/IllustrisTNG/Maps_Mtot_IllustrisTNG_LH_z=0.00.npy...
CDM data shape: (15000, 256, 256)
Loading WDM data from /n/netscratch/iaifi_lab/Lab/msliu/Maps_Mtot_IllustrisTNG_WDM_z=0.00.npy...
WDM data shape: (15000, 256, 256)
Created dataset with 18000 samples
Loading CDM data from /n/netscratch/iaifi_lab/Lab/msliu/CMD/data/IllustrisTNG/Maps_Mtot_IllustrisTNG_LH_z=0.00.npy...
CDM data shape: (15000, 256, 256)
Loading WDM data from /n/netscratch/iaifi_lab/Lab/msliu/Maps_Mtot_IllustrisTNG_WDM_z=0.00.npy...
WDM data shape: (15000, 256, 256)
Created dataset with 6000 samples
Loading CDM data from /n/netscratch/iaifi_lab/Lab/msliu/CMD/data/IllustrisTNG/Maps_Mtot_IllustrisTNG_LH_z=0.00.npy...
CDM data shape: (15000, 256, 256)
Loading WDM data from /n/netscratch/iaifi_lab/Lab/msliu/Maps_Mtot_IllustrisTNG_WDM_z=0.00.npy...
WDM data shape: (15000, 256, 256)
Created dataset with 6000 samples
Data loaders created: Train=563, Val=188, Test=188 batches
Using device: cuda
Using WDMClassifierLarge
Model parameters: 4,503,681 total, 4,503,681 trainable

Starting training for 90 epochs...
  First batch time: 3.770s
  Iterations/sec: 115.50, Total epoch time: 155.84s
Epoch   1: Train Loss=0.6963, Train Acc=0.4994, Val Loss=0.6930, Val Acc=0.5022
  -> New best model saved (Val Acc: 0.5022)
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.80s
Epoch   2: Train Loss=0.6942, Train Acc=0.4998, Val Loss=0.6980, Val Acc=0.5000
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.79s
Epoch   3: Train Loss=0.6945, Train Acc=0.5029, Val Loss=0.6939, Val Acc=0.5008
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.80s
Epoch   4: Train Loss=0.6942, Train Acc=0.4958, Val Loss=0.6933, Val Acc=0.5045
  -> New best model saved (Val Acc: 0.5045)
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.81s
Epoch   5: Train Loss=0.6943, Train Acc=0.5084, Val Loss=0.6925, Val Acc=0.5148
  -> New best model saved (Val Acc: 0.5148)
  First batch time: 0.270s
  Iterations/sec: 118.55, Total epoch time: 151.83s
Epoch   6: Train Loss=0.6862, Train Acc=0.5498, Val Loss=0.7015, Val Acc=0.4922
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.81s
Epoch   7: Train Loss=0.6782, Train Acc=0.5631, Val Loss=0.7156, Val Acc=0.5478
  -> New best model saved (Val Acc: 0.5478)
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.80s
Epoch   8: Train Loss=0.4284, Train Acc=0.7944, Val Loss=0.1702, Val Acc=0.9315
  -> New best model saved (Val Acc: 0.9315)
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.79s
Epoch   9: Train Loss=0.0651, Train Acc=0.9899, Val Loss=0.0276, Val Acc=0.9990
  -> New best model saved (Val Acc: 0.9990)
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.79s
Epoch  10: Train Loss=0.0245, Train Acc=0.9971, Val Loss=0.0125, Val Acc=0.9982
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.78s
Epoch  11: Train Loss=0.0138, Train Acc=0.9981, Val Loss=0.0093, Val Acc=0.9997
  -> New best model saved (Val Acc: 0.9997)
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  12: Train Loss=0.0074, Train Acc=0.9991, Val Loss=0.0053, Val Acc=0.9995
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.81s
Epoch  13: Train Loss=0.0084, Train Acc=0.9987, Val Loss=0.0051, Val Acc=0.9995
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  14: Train Loss=0.0058, Train Acc=0.9993, Val Loss=0.0026, Val Acc=0.9998
  -> New best model saved (Val Acc: 0.9998)
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.80s
Epoch  15: Train Loss=0.0056, Train Acc=0.9993, Val Loss=0.0028, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.60, Total epoch time: 151.77s
Epoch  16: Train Loss=0.0036, Train Acc=0.9996, Val Loss=0.0014, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.56, Total epoch time: 151.82s
Epoch  17: Train Loss=0.0046, Train Acc=0.9993, Val Loss=0.0026, Val Acc=0.9995
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.81s
Epoch  18: Train Loss=0.0047, Train Acc=0.9988, Val Loss=0.0038, Val Acc=0.9992
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.78s
Epoch  19: Train Loss=0.0025, Train Acc=0.9995, Val Loss=0.0011, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.78s
Epoch  20: Train Loss=0.0086, Train Acc=0.9978, Val Loss=0.0020, Val Acc=0.9995
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.78s
Epoch  21: Train Loss=0.0029, Train Acc=0.9992, Val Loss=0.0011, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.78s
Epoch  22: Train Loss=0.0022, Train Acc=0.9996, Val Loss=0.0012, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  23: Train Loss=0.0020, Train Acc=0.9997, Val Loss=0.0016, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  24: Train Loss=0.0031, Train Acc=0.9991, Val Loss=0.0011, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.79s
Epoch  25: Train Loss=0.0016, Train Acc=0.9997, Val Loss=0.0008, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.80s
Epoch  26: Train Loss=0.0015, Train Acc=0.9996, Val Loss=0.0012, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.81s
Epoch  27: Train Loss=0.0028, Train Acc=0.9992, Val Loss=0.0007, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.56, Total epoch time: 151.82s
Epoch  28: Train Loss=0.0009, Train Acc=0.9998, Val Loss=0.0018, Val Acc=0.9993
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.81s
Epoch  29: Train Loss=0.0061, Train Acc=0.9983, Val Loss=0.0009, Val Acc=1.0000
  -> New best model saved (Val Acc: 1.0000)
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.81s
Epoch  30: Train Loss=0.0019, Train Acc=0.9996, Val Loss=0.0013, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.81s
Epoch  31: Train Loss=0.0012, Train Acc=0.9998, Val Loss=0.0010, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.80s
Epoch  32: Train Loss=0.0007, Train Acc=1.0000, Val Loss=0.0007, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  33: Train Loss=0.0048, Train Acc=0.9988, Val Loss=0.0012, Val Acc=0.9995
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.80s
Epoch  34: Train Loss=0.0011, Train Acc=0.9997, Val Loss=0.0010, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.79s
Epoch  35: Train Loss=0.0012, Train Acc=0.9997, Val Loss=0.0010, Val Acc=0.9995
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  36: Train Loss=0.0007, Train Acc=0.9999, Val Loss=0.0007, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  37: Train Loss=0.0009, Train Acc=0.9999, Val Loss=0.0009, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  38: Train Loss=0.0008, Train Acc=0.9998, Val Loss=0.0007, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.78s
Epoch  39: Train Loss=0.0010, Train Acc=0.9997, Val Loss=0.0032, Val Acc=0.9988
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.80s
Epoch  40: Train Loss=0.0006, Train Acc=0.9998, Val Loss=0.0007, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.78s
Epoch  41: Train Loss=0.0007, Train Acc=0.9999, Val Loss=0.0008, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  42: Train Loss=0.0009, Train Acc=0.9998, Val Loss=0.0010, Val Acc=0.9995
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.80s
Epoch  43: Train Loss=0.0006, Train Acc=0.9998, Val Loss=0.0006, Val Acc=0.9995
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  44: Train Loss=0.0005, Train Acc=0.9999, Val Loss=0.0008, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.78s
Epoch  45: Train Loss=0.0004, Train Acc=0.9999, Val Loss=0.0007, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.57, Total epoch time: 151.80s
Epoch  46: Train Loss=0.0007, Train Acc=0.9998, Val Loss=0.0005, Val Acc=0.9997
  First batch time: 0.270s
  Iterations/sec: 118.58, Total epoch time: 151.79s
Epoch  47: Train Loss=0.0005, Train Acc=0.9999, Val Loss=0.0005, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.59, Total epoch time: 151.78s
Epoch  48: Train Loss=0.0002, Train Acc=0.9999, Val Loss=0.0006, Val Acc=0.9998
  First batch time: 0.270s
  Iterations/sec: 118.56, Total epoch time: 151.83s
Epoch  49: Train Loss=0.0002, Train Acc=1.0000, Val Loss=0.0006, Val Acc=0.9997
Early stopping triggered after 49 epochs

Loading best model for final evaluation...

Final Results:
Best Val Acc: 1.0000
Test Acc: 1.0000
Feature maps saved as 'cnn_feature_maps_blur_tot_sid.png'

Training completed!
